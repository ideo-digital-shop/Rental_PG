<h1>Devices</h1>
  <% if flash[:notice] -%>
    <p class='notice'><%=h flash[:notice] %></p>
  <% end -%>
<table class="table table-condensed">
  <tr>
    <th>Device</th>
    <th>Device type</th>
    <th>Rented to</th>
    <th>Available After</th>
    <th></th>
  </tr>

<% @devices.each do |device| %>
  <tr>
    <td><%= device.device_id %></td>
    <td><%= device.device_type %></td>
    <% latest_rental = device.rental %>
    <% rental_empty = device.rental.nil? %>
    <td><%= (rental_empty ? "n/a": (mail_to latest_rental.email)) %></td>
    <td><%= (rental_empty ? "Currently Available": latest_rental.end) %> </td>
    <td><%= (rental_empty ? (link_to 'Rent', {:controller => "rentals", :action => "new", :device_id => device.device_id}, :class => "btn btn-inverse btn-small"):(link_to 'Return', latest_rental, method: :delete, data: { confirm: 'Are you sure?' }, :class => "btn btn-success btn-small")) %></td>
  </tr>
<% end %>
</table>
<br />
<%= link_to 'New Device', new_device_path, :class => "btn btn-primary" %>
